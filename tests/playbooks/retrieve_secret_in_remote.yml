---
- hosts: conjurized-container-test
  tasks:
    - name: Retrieve secrets with target identity
      retrieve_conjur_variable:
        variables:
          RETRIEVED_PASSWORD: ansible/target-password
          ANOTHER_RETRIEVED_PASSWORD: ansible/another-target-password
      register: result

    - name: Do something with the secret {{result.secrets['RETRIEVED_PASSWORD']}}
      shell: echo "ansible/target-password = {{result.secrets['RETRIEVED_PASSWORD']}}, ansible/another-target-password = {{result.secrets['ANOTHER_RETRIEVED_PASSWORD']}}" > ./conjur_secrets.txt

#    - name: Retrieve non existing secrets with target identity
#      retrieve_conjur_variable:
#        variables:
#          RETRIEVED_PASSWORD: ansible/non-existing-password
#      register: result
#
#    - name: Do something with the secrets
#      shell: echo "ansible/target-password = {{result.secrets['RETRIEVED_PASSWORD']}}" > ./conjur_non_existing_secrets.txt
#
#    - name: Retrieve non permitted secrets with target identity
#      retrieve_conjur_variable:
#        variables:
#          RETRIEVED_PASSWORD: ansible/master-password
#      register: result
#
#    - name: Do something with the secret
#      shell: echo "ansible/target-password = {{result.secrets['RETRIEVED_PASSWORD']}}" > ./conjur_non_permitted_secrets.txt
